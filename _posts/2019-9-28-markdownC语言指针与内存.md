---
layout: post
title: C语言的指针和内存
tags: 基础
stickie: true
---

# C语言 指针和内存

## 一、c语言的内存分配与释放

### ①局部变量，全局变量，静态变量

在一个函数体内部声明的普通变量都是局部变量，局部变量会在栈上申请空间，函数结束后，申请的空间会自动释放。而全局变量是在函数体外申请的，会被存放在全局（静态区）上，知道程序结束后才会被结束，这样它的作用域就是整个程序。静态变量和全局变量的存储方式相同，在函数体内声明为static就可以使此变量像全局变量一样使用，不用担心函数结束而被释放。



### ②malloc函数+free函数

malloc函数将可用的内存块连接为一个长长的列表的所谓空闲链表。调用malloc函数时，它沿连接表寻找一个大到足以满足用户请求所需要的内存块。然后，将该内存块一分为二（一块的大小与用户请求的大小相等，另一块的大小就是剩下的字节）。接下来，将分配给用户的那块内存传给用户，并将剩下的那块（如果有的话）返回到连接表上。调用free函数时，它将用户释放的内存块连接到空闲链上。到最后，空闲链会被切成很多的小内存片段，如果这时用户申请一个大的内存片段，那么空闲链上可能没有可以满足用户要求的片段了。于是，malloc函数请求延时，并开始在空闲链上检查各内存片段，进行整理，将相邻的小空闲块合并成较大的内存块。如果无法获得符合要求的内存块，malloc函数会返回NULL指针，因此在调用malloc动态申请内存块时，一定要进行返回值的判断。

### ③栈区：由编译器自动分配释放，存放函数的参数值，局部变量的值。其操作方式类似于数据结构中的栈。

堆区：一般由程序员分配释放，若程序员不释放，程序结束时可能由OS回收。注意它与数据结构中的堆是两回事，分配方式倒是类似于链表
全局区（静态区）：全局变量和静态变量的存储是放在一块的，初始化的全局变量和静态变量在一块区域，未初始化的全局变量和未初始化的静态变量在相邻的另一块区域。  程序结束后由系统释放。
常量区：常量字符串就是放在这里的，直到程序结束后由系统释放。
代码区：存放函数体的二进制代码。



## 二、c语言指针

首先约定一下：指针”是指地址， 是常量，“指针变量”是指取值为地址的变量。 定义指针的目的是为了通过指针去访问内存单元。

①指针变量定义：int *p//应该注意的是，一个指针变量只能指向同类型的变量，如p 只能指向浮点变量，不能时而指向一个浮点变量， 时而又指向一个字符变量。
②指针变量赋值：指针变量的赋值只能赋予地址，否则后果严重。 Ｃ语言中提供了地址运算符&来表示变量的地址。其一般形式为： & 变量名； 如&a变示变量a的地址。
赋值方式：
(1)指针变量初始化的方法 int a;
int *p=&a;
(2)赋值语句的方法 int a;
int *p;p=&a;
③指针变量运算符
取地址运算符&结合性为自右至左，其功能是取变量的地址；取内容运算符*：结合性自右至左，用来表示指针变量所指的变量，注意！在指针变量说明中，“*”是类型说明符，表示其后的变量是指针类型。而表达式中出现的“*”则是一个运算符用以表示指针变量所指的变量。

④指针变量的运算
赋值运算：①指针变量初始化赋值，前面已作介绍。                                                                                                                ②把一个变量的地址赋予指向相同数据类型的指针变量。例如：int a,*pa;pa=&a; 

③把一个指针变量的值赋予指向相同类型变量的另一个指针变量。如：int a,*pa=&a,*pb;pb=pa;                                               ④把数组的首地址赋予指向数组的指针变量。例如： int a[5],*pa;pa=a; (数组名表示数组的首地址，故可赋予指向数组的指针变量pa)|| 也可写为：pa=&a[0]; /*数组第一个元素的地址也是整个数组的首地址，也可赋予pa*/||当然也可采取初始化赋值的方法：int a[5],*pa=a;                                                        

⑤把字符串的首地址赋予指向字符类型的指针变量。例如： char *pc;pc="c language";或用初始化赋值的方法写为： char *pc="C Language"; 这里并不是把整个字符串装入指针变量， 而是把存放该字符串的字符数组的首地址装入指针变量。             ⑥把函数的入口地址赋予指向函数的指针变量。例如： int (*pf)();pf=f; /*f为函数名*/

加减算术运算：①两指针变量相减所得之差是两个指针所指数组元素之间相差的元素个数；指针变量的加减运算只能对数组指针变量进行
